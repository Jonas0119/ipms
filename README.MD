## é¡¹ç›®ä»‹ç»

IPMS æ˜¯ä¸€å¥—åŸºäº AGPL v3 å¼€æºåè®®çš„æ™ºæ…§ç‰©ä¸šç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–å¾®ä¿¡å…¬ä¼—å·/å°ç¨‹åº/PC/H5/æ™ºèƒ½ç¡¬ä»¶å¤šç«¯ã€‚åç«¯é‡‡ç”¨ Koa + TypeScript æ„å»ºï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼›å‰ç«¯ä½¿ç”¨ Vue + View Design å¼€å‘ã€‚

> ç¦æ­¢å°†æœ¬é¡¹ç›®çš„ä»£ç å’Œèµ„æºè¿›è¡Œä»»ä½•å½¢å¼çš„å‡ºå”®å’Œç›ˆåˆ©ï¼Œäº§ç”Ÿçš„ä¸€åˆ‡åæœç”±ä¾µæƒè€…è‡ªè´Ÿï¼ï¼

## äº§å“å±•ç¤º

### webä¸­å°

![web1](resources/images/web1.png)
![web3](resources/images/web3.jpg)
![web4](resources/images/web4.jpg)
![web6](resources/images/web6.jpg)
![web8](resources/images/web8.jpg)
![web9](resources/images/web9.jpg)
![web11](resources/images/web11.jpg)

### ä¸šä¸»ç«¯å°ç¨‹åº

<p align="center" >
<img src="resources/images/owner1.jpg" width="320"/>
<img src="resources/images/owner2.jpg" width="320"/>
<img src="resources/images/owner3.jpg" width="320"/>
<img src="resources/images/owner5.jpg" width="320"/>
<img src="resources/images/owner6.jpg" width="320"/>
<img src="resources/images/owner7.jpg" width="320"/>
</p>

### å‘˜å·¥ç«¯å°ç¨‹åº

<p align="center" >
<img src="resources/images/pc1.jpg" width="320"/>
<img src="resources/images/pc3.jpg" width="320"/>
<img src="resources/images/pc4.jpg" width="320"/>
<img src="resources/images/pc5.jpg" width="320"/>
</p>

## å¦‚ä½•éƒ¨ç½²

### Docker éƒ¨ç½²ï¼ˆRedis â†’ MySQL â†’ MinIO â†’ åç«¯ â†’ å‰ç«¯ï¼‰

0) ç½‘ç»œä¸ç›®å½•
```bash
docker network create ipms-net || true
mkdir -p ~/ipms/{mysql-data,redis-data,minio-data,minio-config,frontend-dist}
```

1) MySQL
```bash
docker run -d --name ipms-mysql --network ipms-net \
  -e MYSQL_ROOT_PASSWORD='rootpass' -e MYSQL_DATABASE=ipms \
  -v ~/ipms/mysql-data:/var/lib/mysql -p 3306:3306 mysql:5.7

# åˆå§‹åŒ–æ–°åº“ï¼ˆæœ¬æœºæ‰§è¡Œï¼‰
mysql -h127.0.0.1 -uroot -p'rootpass' < resources/db_ipms.sql
```

2) Redis
```bash
docker run -d --name ipms-redis --network ipms-net \
  -v ~/ipms/redis-data:/data -p 6379:6379 redis:6.2.6
```

3) MinIO
```bash
docker run -d --name ipms-minio --network ipms-net \
  -e MINIO_ROOT_USER=admin -e MINIO_ROOT_PASSWORD=minioadmin \
  -v ~/ipms/minio-data:/data -v ~/ipms/minio-config:/root/.minio \
  -p 9000:9000 -p 9001:9001 minio/minio server /data --console-address :9001
```

4) åç«¯ï¼ˆAPI Serverï¼‰
```bash
cd api-server && npm ci && npm run dist
docker run -d --name api-server --network ipms-net \
  -p 6688:6688 -v $(pwd)/dist:/www/apiserver -w /www/apiserver \
  node:24.2.0 sh -c "npm install && node ipms_server.js"
```

5) å‰ç«¯ï¼ˆæ§åˆ¶å°ï¼‰
```bash
cd console-web && npm ci && npm run build
cp -r dist/* ~/ipms/frontend-dist/
docker run -d --name ipms-web -p 8080:80 \
  -v ~/ipms/frontend-dist:/usr/share/nginx/html:ro nginx:1.25
```

## SASSç‰ˆåŠå®šåˆ¶

> å¾®ä¿¡æ·»åŠ å¥½å‹è¯·å¤‡æ³¨æ¥æ„ï¼Œè°¢è°¢ã€‚

<img src="resources/images/qrcode.jpg" width="266"/>

## License

![AGPL](resources/images/agplv3.png)

## æ›´æ–°æ—¥å¿—

### 2024-12-19 å­˜å‚¨æœåŠ¡æ¸…ç†å‡çº§ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰

#### ğŸ§¹ æ—§ä»£ç æ¸…ç†
**æ ¸å¿ƒç›®æ ‡ï¼š** å½»åº•ç§»é™¤æ—§å­˜å‚¨å®ç°ï¼Œç»Ÿä¸€åˆ°æ–°çš„ storage æœåŠ¡
- **åç«¯æ¸…ç†**ï¼šåˆ é™¤ `service/upload/`ã€`service/oss.ts`ã€`types/upload.ts`ã€`module/pc/controller/upload/` ç­‰æ—§å®ç°
- **å‰ç«¯æ¸…ç†**ï¼šåˆ é™¤ `utils/oss.js`ï¼Œç§»é™¤ `utils/index.js` ä¸­çš„ oss å¯¼å‡º
- **é…ç½®ç»Ÿä¸€**ï¼šç§»é™¤ `config.ts` ä¸­çš„ `upload` å’Œ `aliyun` é…ç½®ï¼Œç»Ÿä¸€ä½¿ç”¨ `storage` é…ç½®
- **å…¼å®¹æ¸…ç†**ï¼šåˆ é™¤ `upload.js` ä¸­çš„å…¼å®¹æ€§æ–¹æ³• `getUploadSign`ã€`getOSSConfig` ç­‰

#### âš™ï¸ é…ç½®ç»“æ„ç®€åŒ–
**é…ç½®ç»Ÿä¸€ï¼š** æ‰€æœ‰å­˜å‚¨ç›¸å…³é…ç½®é›†ä¸­åœ¨ `storage` èŠ‚ç‚¹ä¸‹
```yaml
# æ—§é…ç½®ï¼ˆå·²åˆ é™¤ï¼‰
upload: { mode: "local", local: {...} }
aliyun: { accessKeyId: "...", oss: {...} }

# æ–°é…ç½®ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
storage:
  mode: "local"  # local/oss/minio
  local: { savePath: "./uploads", urlPrefix: "/static", baseUrl: "..." }
  oss: { accessKeyId: "...", bucket: "...", region: "..." }
  minio: { endpoint: "...", accessKey: "...", bucket: "..." }
```

#### ğŸ”§ æœåŠ¡æ•´åˆ
- **SMSæœåŠ¡**ï¼šæ”¹ç”¨ `config.storage.oss` é…ç½®æ›¿ä»£ `config.aliyun`
- **é™æ€ä¸­é—´ä»¶**ï¼šç§»é™¤å¯¹ `config.upload` çš„å…¼å®¹æ”¯æŒ
- **è·¯ç”±æ¸…ç†**ï¼šåˆ é™¤ PC æ¨¡å—çš„ `/upload/*` è·¯ç”±

#### âœ… ä¿ç•™é¡¹ç›®
- **MPæ¨¡å—**ï¼šæŒ‰éœ€æ±‚ä¿ç•™å°ç¨‹åºç«¯çš„ä¸Šä¼ ç›¸å…³æ–‡ä»¶
- **ç°æœ‰æ¥å£**ï¼šæ–°çš„ `/storage/*` æ¥å£ä¿æŒä¸å˜
- **å‰ç«¯ç»„ä»¶**ï¼šæ‰€æœ‰ä¸Šä¼ ç»„ä»¶ç»§ç»­æ­£å¸¸å·¥ä½œ

#### ğŸ› MPæ¨¡å—ä¿®å¤
**é—®é¢˜ï¼š** MPæ¨¡å—ä¸Šä¼ æ§åˆ¶å™¨å¼•ç”¨å·²åˆ é™¤çš„æ—§ä¸Šä¼ æœåŠ¡å¯¼è‡´ç¼–è¯‘é”™è¯¯
- **ä¿®å¤æ–‡ä»¶**ï¼š`mp/controller/upload/local.ts` å’Œ `mp/controller/upload/sign.ts`
- **è§£å†³æ–¹æ¡ˆ**ï¼šå°†æ—§çš„ `uploadService` æ›¿æ¢ä¸ºæ–°çš„ `StorageServiceFactory`
- **æŠ€æœ¯å‡çº§**ï¼šä½¿ç”¨ç»Ÿä¸€çš„å­˜å‚¨æœåŠ¡æ¥å£ï¼Œä¿æŒåŠŸèƒ½ä¸€è‡´æ€§
- **éªŒè¯ç»“æœ**ï¼šåç«¯ç¼–è¯‘æµ‹è¯•é€šè¿‡ï¼Œæ¥å£åŠŸèƒ½æ­£å¸¸

#### ğŸ¯ å‡çº§æ•ˆæœ
- **ä»£ç å‡å°‘**ï¼šåˆ é™¤çº¦ 2000+ è¡Œå†—ä½™ä»£ç 
- **é…ç½®ç®€åŒ–**ï¼šé…ç½®æ–‡ä»¶ç»“æ„æ›´æ¸…æ™°ç»Ÿä¸€
- **ç»´æŠ¤æ€§æå‡**ï¼šå•ä¸€å­˜å‚¨æœåŠ¡æ¶æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **ç¼–è¯‘éªŒè¯**ï¼šå‰åç«¯æ„å»ºæµ‹è¯•å…¨éƒ¨é€šè¿‡
- **é—®é¢˜ä¿®å¤**ï¼šMPæ¨¡å—ç¼–è¯‘é”™è¯¯å®Œå…¨è§£å†³

### 2024-12-19 ç³»ç»Ÿå­˜å‚¨ä¸æ¨¡æ¿ç®¡ç†å…¨é¢å‡çº§

#### ğŸ“¦ å­˜å‚¨æœåŠ¡ç»Ÿä¸€å‡çº§
**æ ¸å¿ƒæ”¹è¿›ï¼š** å®ç°å‰ç«¯é›¶é…ç½®çš„ç»Ÿä¸€ä¸Šä¼ ä½“éªŒ
- **æ–°å¢æ¥å£**ï¼š`/storage/config` ç»Ÿä¸€å­˜å‚¨é…ç½®ï¼Œ`/storage/upload` ç»Ÿä¸€ä¸Šä¼ å¤„ç†
- **å‰ç«¯æ”¹è¿›**ï¼šæ•´åˆ `oss.js` å’Œ `upload.js` ä¸ºç»Ÿä¸€ `upload.js`ï¼Œæ”¯æŒä¸‰ç§ä¸Šä¼ ç­–ç•¥(server/direct/presigned)
- **ç»„ä»¶å‡çº§**ï¼šImageUploadã€AvatarCropã€FileUploadã€MultipleImageUpload å…¨éƒ¨ä½¿ç”¨æ–°æœåŠ¡
- **é…ç½®ç®€åŒ–**ï¼šåˆ é™¤å‰ç«¯å­˜å‚¨é…ç½®åŠŸèƒ½ï¼Œç»Ÿä¸€ç”±åç«¯ç®¡ç†

#### ğŸ—‚ï¸ æ¨¡æ¿ç®¡ç†ç³»ç»Ÿé‡æ„
**æ ¸å¿ƒæ”¹è¿›ï¼š** é…ç½®ç»Ÿä¸€åŒ–ã€æ¨¡æ¿ç®¡ç†é€šç”¨åŒ–
- **æ–°å¢æœåŠ¡**ï¼š`template.ts` ç»Ÿä¸€æ¨¡æ¿ç®¡ç†æœåŠ¡
- **æ–°å¢æ¥å£**ï¼š`/template/config` é…ç½®è·å–ï¼Œ`/template/download/:type` é€šç”¨ä¸‹è½½
- **å‰ç«¯å·¥å…·**ï¼šæ–°å¢ `template.js` å·¥å…·ç±»ï¼Œæ™ºèƒ½ä¸‹è½½ç­–ç•¥(ç›´é“¾ä¼˜å…ˆ)
- **é…ç½®ä¼˜åŒ–**ï¼šå­˜å‚¨é…ç½®ç»“æ„ç»Ÿä¸€ï¼Œæ¨¡æ¿è·¯å¾„å¯é…ç½®

#### ğŸ› å…³é”®é—®é¢˜ä¿®å¤
- **404é”™è¯¯**ï¼šä¿®å¤ Upload ç»„ä»¶ action å±æ€§å¯¼è‡´çš„è¯·æ±‚é”™è¯¯
- **é™æ€æ–‡ä»¶**ï¼šä¿®å¤æœ¬åœ°å­˜å‚¨æ¨¡å¼ä¸‹é™æ€æ–‡ä»¶è®¿é—®é—®é¢˜
- **MinIOæ¨¡æ¿**ï¼šä¼˜åŒ– MinIO æ¨¡å¼ä¸‹æ¨¡æ¿ä¸‹è½½å¤„ç†
- **ä»£ç è´¨é‡**ï¼šä¿®å¤æ‰€æœ‰ lint é”™è¯¯ï¼Œæå‡ä»£ç è§„èŒƒ

#### âš¡ æŠ€æœ¯ç‰¹æ€§
- **é›¶é…ç½®**ï¼šå‰ç«¯è‡ªåŠ¨è·å–å­˜å‚¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
- **å‘åå…¼å®¹**ï¼šä¿æŒåŸæœ‰æ¥å£ä¸å˜ï¼Œå¹³æ»‘å‡çº§
- **æ™ºèƒ½é€‰æ‹©**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ä¸Šä¼ /ä¸‹è½½ç­–ç•¥
- **æ˜“æ‰©å±•**ï¼šæ–°å¢å­˜å‚¨æ–¹å¼æˆ–æ¨¡æ¿ç±»å‹ä»…éœ€åç«¯é…ç½®

#### ğŸ”§ ä½¿ç”¨æ–¹å¼
```javascript
// ç»Ÿä¸€ä¸Šä¼ 
import uploadService from '@/utils/upload';
await uploadService.upload(file, { dir: 'images' });

// æ¨¡æ¿ä¸‹è½½
import templateService from '@/utils/template';
await templateService.downloadTemplate('building_import');

// ç»„ä»¶ä½¿ç”¨
<ImageUpload v-model="imageUrl" dir="avatar" />
```

#### ğŸ“‹ é…ç½®ç¤ºä¾‹
```yaml
# .ipmsrc é…ç½®æ–‡ä»¶ï¼ˆåŸ .ejyyrc å‡çº§ï¼‰
storage:
  mode: "local"  # local/oss/minio
  template:
    path: "template"
    files:
      building_import: "å›ºå®šèµ„äº§å¯¼å…¥æ¨¡æ¿.xlsx"
  local:
    savePath: "./uploads"
    urlPrefix: "/static"
    baseUrl: "http://127.0.0.1:6688"
```

**å‡çº§æ•ˆæœï¼š** å¼€å‘æ•ˆç‡æå‡ã€ç»´æŠ¤æˆæœ¬é™ä½ã€ç”¨æˆ·ä½“éªŒæ”¹å–„ã€é…ç½®ç®¡ç†ç®€åŒ–

### 2024-12-19 ç‰ˆæƒå£°æ˜ä¿®å¤ä¸ä»£ç è´¨é‡æå‡

#### ğŸ”§ ç‰ˆæƒå£°æ˜æ ‡å‡†åŒ–
**æ ¸å¿ƒç›®æ ‡ï¼š** ç»Ÿä¸€é¡¹ç›®ç‰ˆæƒå£°æ˜æ ¼å¼ï¼Œæå‡ä»£ç è§„èŒƒæ€§
- **é—®é¢˜è¯†åˆ«**ï¼šå‘ç°é”™è¯¯æ ¼å¼ `/**//** * | å¼€æºç‰©ä¸šç®¡ç†ç³»ç»Ÿï¼Œæ•¬è¯·ä½¿ç”¨ */ */`
- **æ ¼å¼ç»Ÿä¸€**ï¼šæ ‡å‡†åŒ–ä¸ºæ­£ç¡®æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´çš„åˆ†éš”çº¿è®¾è®¡
- **è¦†ç›–èŒƒå›´**ï¼šå¤„ç† 825 ä¸ªæºæ–‡ä»¶ï¼Œä¿®å¤ 800 ä¸ªæ–‡ä»¶çš„ç‰ˆæƒå£°æ˜
- **è‡ªåŠ¨åŒ–å·¥å…·**ï¼šå¼€å‘ `fix_copyright.py` è„šæœ¬ï¼Œæ”¯æŒæ‰¹é‡ä¿®å¤

#### ğŸ› ä»£ç è¯­æ³•ä¿®å¤
**è´¨é‡æå‡ï¼š** ä¿®å¤å‰åç«¯é¡¹ç›®ä¸­çš„è¯­æ³•é”™è¯¯
- **å‰ç«¯ä¿®å¤**ï¼š
  - `copyright.vue` HTML è¯­æ³•é”™è¯¯ï¼ˆå¤šä½™çš„é—­åˆæ ‡ç­¾ï¼‰
  - `dashboard/index.vue` JavaScript è®¡ç®—è¡¨è¾¾å¼é”™è¯¯
- **åç«¯ä¿®å¤**ï¼š
  - `service/map.ts` TypeScript æ•°å­¦è¿ç®—ç¬¦è¯­æ³•é”™è¯¯
- **éªŒè¯å·¥å…·**ï¼šESLintã€Prettierã€TypeScript ç¼–è¯‘å™¨å…¨é¢æ£€æŸ¥

#### âœ… éªŒè¯ç»“æœ
- **ç‰ˆæƒå£°æ˜è¦†ç›–ç‡**ï¼š97.0% (800/825 ä¸ªæ–‡ä»¶)
- **é”™è¯¯æ ¼å¼æ¸…é›¶**ï¼š0 ä¸ªé”™è¯¯çš„ç‰ˆæƒå£°æ˜æ ¼å¼
- **è¯­æ³•é”™è¯¯æ¸…é›¶**ï¼šå‰åç«¯é¡¹ç›®ç¼–è¯‘æµ‹è¯•å…¨éƒ¨é€šè¿‡
- **ä»£ç æ ¼å¼åŒ–**ï¼šæ‰€æœ‰æ–‡ä»¶é€šè¿‡ Prettier æ ¼å¼åŒ–

#### ğŸ› ï¸ æŠ€æœ¯å·¥å…·
- **ä¿®å¤è„šæœ¬**ï¼š`fix_copyright.py` - æ™ºèƒ½è¯†åˆ«å’Œä¿®å¤ç‰ˆæƒå£°æ˜
- **è´¨é‡æ£€æŸ¥**ï¼šESLint (Vue)ã€TypeScript Compilerã€Prettier
- **é¡¹ç›®ç»“æ„**ï¼šå‰ç«¯ Vue.js + View Designï¼Œåç«¯ Node.js + TypeScript + Koa

#### ğŸ“Š ç»Ÿè®¡æ•°æ®
- **æ€»æºæ–‡ä»¶**ï¼š825 ä¸ª (.js, .ts, .vue)
- **ä¿®å¤æ–‡ä»¶**ï¼š800 ä¸ªåŒ…å«æ­£ç¡®ç‰ˆæƒå£°æ˜
- **è¯­æ³•ä¿®å¤**ï¼š3 ä¸ªæ–‡ä»¶çš„è¯­æ³•é”™è¯¯
- **ä»£ç è´¨é‡**ï¼š100% é€šè¿‡ lint æ£€æŸ¥

**å‡çº§æ•ˆæœï¼š** ä»£ç è§„èŒƒç»Ÿä¸€ã€ç‰ˆæƒå£°æ˜æ ‡å‡†åŒ–ã€é¡¹ç›®è´¨é‡æå‡ã€ç»´æŠ¤æˆæœ¬é™ä½

### 2024-12-19 æ—¥å¿—ç³»ç»Ÿé‡æ„å‡çº§

#### ğŸ”§ è‡ªå®šä¹‰æ—¥å¿—ç³»ç»Ÿ
**æ ¸å¿ƒç›®æ ‡ï¼š** æ›¿æ¢ç¬¬ä¸‰æ–¹æ—¥å¿—ä¾èµ–ï¼Œå®ç°è‡ªä¸»å¯æ§çš„æ—¥å¿—ç®¡ç†
- **æ–°å¢æ¨¡å—**ï¼š`kjhlog` - è‡ªç ”æ—¥å¿—å·¥å…·ï¼Œæ›¿ä»£ `chowa-log` ä¾èµ–
- **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒå¤šçº§åˆ«æ—¥å¿—(DEBUG/INFO/WARN/ERROR)ã€æ–‡ä»¶è¾“å‡ºã€æ§åˆ¶å°è¾“å‡º
- **å…¼å®¹æ€§å¼º**ï¼šä¿æŒä¸åŸ `cwlog` API å®Œå…¨å…¼å®¹ï¼Œæ— ç¼æ›¿æ¢
- **æ™ºèƒ½é…ç½®**ï¼šå¼€å‘ç¯å¢ƒæ§åˆ¶å°è¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒæ–‡ä»¶è®°å½•

#### ğŸ› ï¸ æ‰¹é‡ä»£ç è¿ç§»
**è‡ªåŠ¨åŒ–å¤„ç†ï¼š** å¼€å‘è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ‰¹é‡å¤„ç†ä»£ç è¿ç§»
- **å½±å“èŒƒå›´**ï¼š21 ä¸ªæ–‡ä»¶çš„æ—¥å¿—è°ƒç”¨å…¨éƒ¨è¿ç§»
- **å¯¼å…¥ç®¡ç†**ï¼šè‡ªåŠ¨æ·»åŠ  `kjhlog` å¯¼å…¥è¯­å¥ï¼Œç»Ÿä¸€ä½¿ç”¨ `~/utils/kjhlog` è·¯å¾„
- **APIå…¼å®¹**ï¼šæ”¯æŒ `log()`ã€`info()`ã€`warn()`ã€`error()`ã€`success()`ã€`warning()` æ–¹æ³•
- **å…¨å±€å¯ç”¨**ï¼šåœ¨ `app.ts` ä¸­åˆå§‹åŒ–å…¨å±€ `kjhlog` å®ä¾‹

#### ğŸ› ç¼–è¯‘é—®é¢˜ä¿®å¤
**è´¨é‡ä¿è¯ï¼š** ä¿®å¤ç¼–è¯‘è¿‡ç¨‹ä¸­å‘ç°çš„å„ç±»é—®é¢˜
- **å‚æ•°é”™è¯¯**ï¼šä¿®å¤ `oa/controller/service/reply.ts` ä¸­ `msg.text()` å‚æ•°ç¼ºå¤±
- **æ–¹æ³•é‡å¤**ï¼šé‡æ„ `kjhlog` å†…éƒ¨æ–¹æ³•ï¼Œé¿å…æ–¹æ³•åå†²çª
- **ç±»å‹å®‰å…¨**ï¼šç¡®ä¿æ‰€æœ‰ TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- **ç¼–è¯‘éªŒè¯**ï¼šwebpack æ„å»ºæµ‹è¯•å®Œå…¨é€šè¿‡

#### âš¡ æ—¥å¿—ç‰¹æ€§
- **æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶**ï¼šç”Ÿäº§ç¯å¢ƒæŒ‰æ—¥æœŸè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶
- **æ ¼å¼ç»Ÿä¸€**ï¼š`[æ—¶é—´æˆ³] [çº§åˆ«] æ¶ˆæ¯å†…å®¹` æ ‡å‡†æ ¼å¼
- **ç¯å¢ƒé€‚é…**ï¼šå¼€å‘ç¯å¢ƒè¯¦ç»†è¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒç²¾ç®€è®°å½•
- **é”™è¯¯å¤„ç†**ï¼šæ—¥å¿—å†™å…¥å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°æ§åˆ¶å°

#### ğŸ“Š è¿ç§»ç»Ÿè®¡
- **æ›¿æ¢æ–‡ä»¶**ï¼š21 ä¸ª TypeScript æ–‡ä»¶
- **æ—¥å¿—è°ƒç”¨**ï¼š30+ å¤„æ—¥å¿—è°ƒç”¨ç‚¹å…¨éƒ¨è¿ç§»
- **ç¼–è¯‘çŠ¶æ€**ï¼šâœ… é›¶é”™è¯¯é€šè¿‡ webpack æ„å»º
- **ä¾èµ–æ¸…ç†**ï¼šç§»é™¤å¯¹ç¬¬ä¸‰æ–¹æ—¥å¿—åº“çš„ä¾èµ–

**å‡çº§æ•ˆæœï¼š** æ—¥å¿—ç³»ç»Ÿè‡ªä¸»å¯æ§ã€å‡å°‘å¤–éƒ¨ä¾èµ–ã€æå‡ç³»ç»Ÿç¨³å®šæ€§ã€ä¾¿äºåç»­ç»´æŠ¤æ‰©å±•

### 2024-12-19 å‰ç«¯é…ç½®ä¼˜åŒ–

#### ğŸ”§ ç½‘ç«™æ ‡é¢˜é…ç½®ä¿®å¤
**é—®é¢˜è§£å†³ï¼š** ä¿®å¤å‰ç«¯ç¼–è¯‘è­¦å‘Šï¼Œå®Œå–„é…ç½®ç®¡ç†
- **è­¦å‘Šä¿®å¤**ï¼šè§£å†³ `SITE_TITLE` é…ç½®é¡¹ç¼ºå¤±å¯¼è‡´çš„ç¼–è¯‘è­¦å‘Š
- **æ ‡é¢˜è®¾ç½®**ï¼šç»Ÿä¸€ç½‘ç«™æ ‡é¢˜ä¸º"æ™ºæ…§ç‰©ä¸šç®¡ç†å¹³å°"
- **åº”ç”¨èŒƒå›´**ï¼šé¡µé¢æ ‡é¢˜ã€å¯¼èˆªæ ã€æ‰“å°é¡µé¢ã€IoTä»ªè¡¨æ¿ç­‰å¤šå¤„ä½¿ç”¨
- **æ„å»ºéªŒè¯**ï¼šå‰ç«¯æ„å»ºæµ‹è¯•é€šè¿‡ï¼Œæ— è­¦å‘Šä¿¡æ¯

#### ğŸ“Š å½±å“ç»Ÿè®¡
- **é…ç½®æ–‡ä»¶**ï¼š`console-web/src/config.js` æ–°å¢ `SITE_TITLE` é…ç½®
- **ä½¿ç”¨ä½ç½®**ï¼š5+ ä¸ªç»„ä»¶å’Œé¡µé¢å¼•ç”¨è¯¥é…ç½®
- **æ„å»ºçŠ¶æ€**ï¼šâœ… å‰ç«¯æ„å»ºæ— è­¦å‘Šé€šè¿‡
- **ç”¨æˆ·ä½“éªŒ**ï¼šç»Ÿä¸€çš„å“ç‰Œæ ‡è¯†å’Œé¡µé¢æ ‡é¢˜

**å‡çº§æ•ˆæœï¼š** é…ç½®å®Œæ•´æ€§æå‡ã€ç¼–è¯‘è­¦å‘Šæ¸…é›¶ã€å“ç‰Œæ ‡è¯†ç»Ÿä¸€ã€ç”¨æˆ·ä½“éªŒæ”¹å–„


#how to run
#åå°æœåŠ¡
docker run -d --name api-server   -p 6688:6688   -v /Users/pzq/tech/projects/ipms/api-server/dist:/www/apiserver   -w /www/apiserver   node:24.2.0   sh -c "npm install && node ipms_server.js"

#mysql
docker run -d --name my-redis -p 6379:6379 redis:6.2.6
docker exec -it mysql57 mysql -u root -p

TRUNCATE TABLE `ipms_ask_for_leave`;                           
TRUNCATE TABLE `ipms_ask_for_leave_flow`;                      
TRUNCATE TABLE `ipms_building_info`;                           
TRUNCATE TABLE `ipms_community_info`;                          
TRUNCATE TABLE `ipms_community_remote_open_door_log`;          
TRUNCATE TABLE `ipms_community_setting`;                       
TRUNCATE TABLE `ipms_complain`;                                
TRUNCATE TABLE `ipms_contract`;                                
TRUNCATE TABLE `ipms_contract_category`;                       
TRUNCATE TABLE `ipms_contract_item`;                           
TRUNCATE TABLE `ipms_convenient`;                              
TRUNCATE TABLE `ipms_employee_sign_record`;                    
TRUNCATE TABLE `ipms_employee_sign_setting`;                   
TRUNCATE TABLE `ipms_feedback`;                                
TRUNCATE TABLE `ipms_fitment`;                                 
TRUNCATE TABLE `ipms_inform`;                                  
TRUNCATE TABLE `ipms_iot_elevator`;                            
TRUNCATE TABLE `ipms_iot_elevator_log`;                        
TRUNCATE TABLE `ipms_iot_entrance`;                            
TRUNCATE TABLE `ipms_iot_entrance_log`;                        
TRUNCATE TABLE `ipms_iot_lamp`;                                
TRUNCATE TABLE `ipms_iot_lamp_line`;                           
TRUNCATE TABLE `ipms_iot_lamp_log`;                            
TRUNCATE TABLE `ipms_iot_lamp_work_mode`;                      
TRUNCATE TABLE `ipms_iot_meter`;                               
TRUNCATE TABLE `ipms_iot_meter_read`;                          
TRUNCATE TABLE `ipms_iot_meter_repeater`;                      
TRUNCATE TABLE `ipms_iot_park`;                                
TRUNCATE TABLE `ipms_iot_park_blacklist`;                      
TRUNCATE TABLE `ipms_iot_park_log`;                            
TRUNCATE TABLE `ipms_iot_warning`;                             
TRUNCATE TABLE `ipms_iot_warning_log`;                         
TRUNCATE TABLE `ipms_material`;                                
TRUNCATE TABLE `ipms_material_category`;                       
TRUNCATE TABLE `ipms_material_purchase`;                       
TRUNCATE TABLE `ipms_material_purchase_flow`;                  
TRUNCATE TABLE `ipms_material_purchase_item`;                  
TRUNCATE TABLE `ipms_material_supplier`;                       
TRUNCATE TABLE `ipms_material_used`;                           
TRUNCATE TABLE `ipms_meeting`;                                 
TRUNCATE TABLE `ipms_meeting_participant`;                     
TRUNCATE TABLE `ipms_meeting_room`;                            
TRUNCATE TABLE `ipms_mission`;                                 
TRUNCATE TABLE `ipms_mission_category`;                        
TRUNCATE TABLE `ipms_mission_complete`;                        
TRUNCATE TABLE `ipms_mission_complete_node`;                   
TRUNCATE TABLE `ipms_mission_line`;                            
TRUNCATE TABLE `ipms_mission_line_node`;                       
TRUNCATE TABLE `ipms_mission_point`;                           
TRUNCATE TABLE `ipms_move_car`;                                
TRUNCATE TABLE `ipms_notice_to_user`;                          
TRUNCATE TABLE `ipms_notice_to_user_readed`;                   
TRUNCATE TABLE `ipms_notice_tpl`;                              
TRUNCATE TABLE `ipms_owner_apply`;                             
TRUNCATE TABLE `ipms_owner_detail_log`;                        
TRUNCATE TABLE `ipms_party`;                                   
TRUNCATE TABLE `ipms_pet`;                                     
TRUNCATE TABLE `ipms_pet_vaccinate`;                           
TRUNCATE TABLE `ipms_property_company_access`;                 
TRUNCATE TABLE `ipms_property_company_auth`;                   
TRUNCATE TABLE `ipms_property_company_building_registered`;    
TRUNCATE TABLE `ipms_property_company_department`;             
TRUNCATE TABLE `ipms_property_company_job`;                    
TRUNCATE TABLE `ipms_property_company_user`;                   
TRUNCATE TABLE `ipms_property_company_user_access_community`;  
TRUNCATE TABLE `ipms_property_company_user_default_community`; 
TRUNCATE TABLE `ipms_property_company_user_join_record`;       
TRUNCATE TABLE `ipms_property_company_user_login`;             
TRUNCATE TABLE `ipms_property_fee`;                            
TRUNCATE TABLE `ipms_property_fee_order`;                      
TRUNCATE TABLE `ipms_property_fee_order_item`;                 
TRUNCATE TABLE `ipms_question`;                                
TRUNCATE TABLE `ipms_question_option`;                         
TRUNCATE TABLE `ipms_questionnaire`;                           
TRUNCATE TABLE `ipms_questionnaire_answer`;                    
TRUNCATE TABLE `ipms_questionnaire_answer_result`;             
TRUNCATE TABLE `ipms_questionnaire_statistics`;                
TRUNCATE TABLE `ipms_refound`;                                 
TRUNCATE TABLE `ipms_refound_flow`;                            
TRUNCATE TABLE `ipms_refound_item`;                            
TRUNCATE TABLE `ipms_repair`;                                  
TRUNCATE TABLE `ipms_repair_urge`;                             
TRUNCATE TABLE `ipms_schedule`;                                
TRUNCATE TABLE `ipms_session_store`;                           
TRUNCATE TABLE `ipms_storehouse`;                              
TRUNCATE TABLE `ipms_topic`;                                   
TRUNCATE TABLE `ipms_user_building`;                           
TRUNCATE TABLE `ipms_user_building_operate_log`;               
TRUNCATE TABLE `ipms_user_car`;                                
TRUNCATE TABLE `ipms_user_car_operate_log`;                    
TRUNCATE TABLE `ipms_user_car_sync`;                           
TRUNCATE TABLE `ipms_user_default_community`;                  
TRUNCATE TABLE `ipms_vistor`;                                  
TRUNCATE TABLE `ipms_wechat_mp_auth`;                          
TRUNCATE TABLE `ipms_wechat_mp_user`;                          
TRUNCATE TABLE `ipms_wechat_mp_user_login`;                    
TRUNCATE TABLE `ipms_wechat_official_accounts_user`;           
TRUNCATE TABLE `ipms_workflow`;                                
TRUNCATE TABLE `ipms_workflow_node`;                           


#redis

#minio


## ç³»ç»Ÿé‡å‘½åè¿ç§»æ–¹æ¡ˆï¼ˆejyy â†’ ipmsï¼‰

- ç³»ç»Ÿå‘½åã€æ•°æ®åº“åº“åã€è¡¨å‰ç¼€ã€æ„å»ºäº§ç‰©åã€è¯·æ±‚å¤´ã€å¯¹è±¡å­˜å‚¨æ¡¶åå…¨é¢ä»â€œejyyâ€å‡çº§ä¸ºâ€œipmsâ€ã€‚
- å»ºè®®å…ˆå¤‡ä»½æ•°æ®åº“ä¸å¯¹è±¡å­˜å‚¨ï¼Œå†æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œã€‚

### å˜æ›´æ¸…å•ï¼ˆæ¦‚è¦ï¼‰
- é…ç½®æ–‡ä»¶ï¼š`.ejyyrc` â†’ `.ipmsrc`ï¼Œæ•°æ®åº“å `ipms`ï¼ŒMinIO æ¡¶ `ipms`
- åç«¯äº§ç‰©ï¼š`ejyy_server.js` â†’ `ipms_server.js`
- æ•°æ®åº“ï¼šæ‰€æœ‰è¡¨ä» `ejyy_*` â†’ `ipms_*`ï¼›åº“åä» `ejyy` â†’ `ipms`
- å‰ç«¯è¯·æ±‚å¤´ï¼š`ejyy-pc-token` â†’ `ipms-pc-token`ï¼›æœ¬åœ°å‚¨å­˜é”® `EJYY_PC_TOKEN/USER_ID` â†’ `IPMS_PC_TOKEN/USER_ID`

### æ•°æ®åº“è¿ç§»ï¼ˆç”Ÿäº§ï¼‰
```sql
CREATE DATABASE IF NOT EXISTS `ipms` DEFAULT CHARACTER SET utf8mb4;

SET @old_db='ejyy'; SET @new_db='ipms';
SET @old_prefix='ejyy_'; SET @new_prefix='ipms_';

SELECT CONCAT(
  'RENAME TABLE `', TABLE_SCHEMA, '`.`', TABLE_NAME, '` TO `', @new_db, '`.`', REPLACE(TABLE_NAME, @old_prefix, @new_prefix), '`;'
) AS stmt
FROM information_schema.TABLES
WHERE TABLE_SCHEMA=@old_db AND TABLE_NAME LIKE CONCAT(@old_prefix, '%');
-- å°†è¾“å‡ºçš„è¯­å¥æ‰¹é‡æ‰§è¡Œ
```

### å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼ˆåç«¯ï¼‰
```bash
docker run -d --name api-server \
  -p 6688:6688 \
  -v /Users/pzq/tech/projects/ipms/api-server/dist:/www/apiserver \
  -w /www/apiserver \
  node:24.2.0 \
  sh -c "npm install && node ipms_server.js"
```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆ.ipmsrcï¼‰
```yaml
server:
  port: 6688
  name: "IPMS"

mysql:
  host: "localhost"
  port: 3306
  user: "root"
  password: "******"
  database: "ipms"

redis:
  host: "localhost"
  port: 6379
  password: ""

storage:
  mode: "local"
  local:
    savePath: "./uploads"
    urlPrefix: "/static"
    baseUrl: "http://127.0.0.1:6688"
  minio:
    endpoint: "http://127.0.0.1:9000"
    accessKey: "admin"
    secretKey: "******"
    bucket: "ipms"
    useSSL: false
    baseUrl: "http://127.0.0.1:9000"
    customDomain: ""
```

### è¿‡æ¸¡æœŸå…¼å®¹ï¼ˆå¯é€‰ï¼‰
- åç«¯åŒæ—¶æ¥å— `ipms-pc-token` ä¸ `ejyy-pc-token`ã€‚
- é…ç½®åŠ è½½ä¼˜å…ˆ `.ipmsrc`ï¼Œè‹¥ä¸å­˜åœ¨å›é€€ `.ejyyrc`ã€‚
- è§‚å¯ŸæœŸååˆ é™¤å…¼å®¹é€»è¾‘ï¼Œæ¸…ç†æ—§ Redis Keyã€‚

#å‰ç«¯æœåŠ¡


#è·å–docker IP
docker inspect my-redis | grep IPAddress

#è·å–æ‰€æœ‰å®¹å™¨çš„IP
docker inspect -f '{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' $(docker ps -q)

#é…ç½®
1ã€api-server
api-server/src/config.ts  IPéœ€è¦ä¿®æ”¹api-serverå¯¹åº”çš„IP

2ã€console-web
console-web/src/config.js  IPéœ€è¦ä¿®æ”¹console-webå¯¹åº”çš„IP

3ã€åå°é…ç½® api-server/dist/.ipmsrc
1ï¼‰minioçš„IP
2ï¼‰mysqlçš„IP
3ï¼‰redisçš„IP
4ï¼‰